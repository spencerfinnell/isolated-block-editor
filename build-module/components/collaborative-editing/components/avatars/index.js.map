{"version":3,"file":"index.js","names":["Popover","VisuallyHidden","withSelect","withDispatch","useState","__","sprintf","compose","CollaborativeEditingAvatars","_ref","peers","onAvatarClick","MAX_AVATAR_COUNT","shouldOverflow","length","actualAvatarCount","createElement","className","slice","map","peer","CollaborativeEditingAvatar","key","id","CollaborativeEditingAvatarsOverflow","_ref2","isVisible","setIsVisible","name","onMouseEnter","onMouseLeave","onClick","style","borderColor","color","background","animate","avatarUrl","src","alt","charAt","_ref3","MAX_NAME_COUNT","NameList","Fragment","select","getCollabPeers","Object","keys","dispatch","selectBlock","start","clientId"],"sources":["../../../../../src/components/collaborative-editing/components/avatars/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Popover, VisuallyHidden } from '@wordpress/components';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { useState } from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport './style.scss';\n\n/**\n * @param {Object} props\n * @param {import(\"../..\").AvailablePeer[]} props.peers\n * @param {Function} props.onAvatarClick\n */\nexport function CollaborativeEditingAvatars( { peers, onAvatarClick } ) {\n\tconst MAX_AVATAR_COUNT = 4;\n\tconst shouldOverflow = peers.length > MAX_AVATAR_COUNT;\n\tconst actualAvatarCount = shouldOverflow ? MAX_AVATAR_COUNT - 1 : MAX_AVATAR_COUNT;\n\n\treturn (\n\t\t<div className=\"iso-editor-collab-avatars\">\n\t\t\t<VisuallyHidden>Currently editing:</VisuallyHidden>\n\n\t\t\t{ peers.slice( 0, actualAvatarCount ).map( ( peer ) => (\n\t\t\t\t<CollaborativeEditingAvatar key={ peer.id } peer={ peer } onAvatarClick={ onAvatarClick } />\n\t\t\t) ) }\n\n\t\t\t{ shouldOverflow && <CollaborativeEditingAvatarsOverflow peers={ peers?.slice( actualAvatarCount ) } /> }\n\t\t</div>\n\t);\n}\n\nexport function CollaborativeEditingAvatar( { peer, onAvatarClick } ) {\n\tconst [ isVisible, setIsVisible ] = useState( false );\n\n\treturn (\n\t\t<button\n\t\t\tclassName=\"iso-editor-collab-avatars__avatar-btn\"\n\t\t\taria-label={ peer.name }\n\t\t\tonMouseEnter={ () => setIsVisible( true ) }\n\t\t\tonMouseLeave={ () => setIsVisible( false ) }\n\t\t\tonClick={ () => onAvatarClick( peer ) }\n\t\t\tstyle={ {\n\t\t\t\tborderColor: peer.color,\n\t\t\t\tbackground: peer.color,\n\t\t\t} }\n\t\t>\n\t\t\t{ isVisible && (\n\t\t\t\t<Popover className=\"iso-editor-collab-avatars__popover\" animate={ false }>\n\t\t\t\t\t{ peer.name }\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t\t{ peer.avatarUrl ? (\n\t\t\t\t<img className=\"iso-editor-collab-avatars__image\" src={ peer.avatarUrl } alt=\"\" />\n\t\t\t) : (\n\t\t\t\t<span className=\"iso-editor-collab-avatars__name-initial\">{ peer.name.charAt( 0 ) }</span>\n\t\t\t) }\n\t\t</button>\n\t);\n}\n\nexport function CollaborativeEditingAvatarsOverflow( { peers } ) {\n\tconst MAX_NAME_COUNT = 20;\n\tconst [ isVisible, setIsVisible ] = useState( false );\n\n\tconst NameList = () => {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ul className=\"iso-editor-collab-avatars__overflow-list\">\n\t\t\t\t\t{ peers.slice( 0, MAX_NAME_COUNT ).map( ( peer ) => (\n\t\t\t\t\t\t<li className=\"iso-editor-collab-avatars__overflow-list-item\" key={ peer.id }>\n\t\t\t\t\t\t\t{ peer.name }\n\t\t\t\t\t\t</li>\n\t\t\t\t\t) ) }\n\t\t\t\t</ul>\n\t\t\t\t{ peers.length > MAX_NAME_COUNT && (\n\t\t\t\t\t<p className=\"iso-editor-collab-avatars__overflow-more\">\n\t\t\t\t\t\t{ sprintf(\n\t\t\t\t\t\t\t/* translators: %s: number of how many more users there are */\n\t\t\t\t\t\t\t__( 'and %s more' ),\n\t\t\t\t\t\t\tpeers.length - MAX_NAME_COUNT\n\t\t\t\t\t\t) }\n\t\t\t\t\t</p>\n\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t};\n\n\treturn (\n\t\t<div className=\"iso-editor-collab-avatars__overflow\">\n\t\t\t{ isVisible && (\n\t\t\t\t<Popover className=\"iso-editor-collab-avatars__popover\" animate={ false }>\n\t\t\t\t\t<NameList />\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t\t<span\n\t\t\t\taria-hidden=\"true\"\n\t\t\t\tonMouseEnter={ () => setIsVisible( true ) }\n\t\t\t\tonMouseLeave={ () => setIsVisible( false ) }\n\t\t\t>\n\t\t\t\t{ `+${ peers.length }` }\n\t\t\t</span>\n\t\t\t<VisuallyHidden>\n\t\t\t\t<NameList />\n\t\t\t</VisuallyHidden>\n\t\t</div>\n\t);\n}\n\n// @ts-ignore\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst peers = select( 'isolated/editor' ).getCollabPeers();\n\n\t\treturn {\n\t\t\tpeers: Object.keys( peers ).map( ( id ) => {\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\t...peers[ id ],\n\t\t\t\t};\n\t\t\t} ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { selectBlock } = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tonAvatarClick( peer ) {\n\t\t\t\tif ( peer?.start?.clientId ) {\n\t\t\t\t\tselectBlock( peer.start.clientId );\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t} ),\n] )( CollaborativeEditingAvatars );\n"],"mappings":"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"}