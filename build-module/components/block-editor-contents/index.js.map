{"version":3,"file":"index.js","names":["isPromise","Popover","withDispatch","withSelect","compose","useLayoutEffect","parse","rawHandler","BlockEditorProvider","BlockEditor","getInitialEditorContent","getInitialContent","settings","loader","contentLoader","Promise","resolve","then","content","iso","patterns","currentPattern","editor","template","BlockEditorContents","props","blocks","onInput","onChange","selection","clearHistory","isEditing","editorMode","children","renderMoreMenu","onLoad","loadData","initialContent","length","isInitialContent","createElement","value","useSubRegistry","Slot","select","ownProps","_ownProps$blocks","getBlocks","getEditorSelection","getEditorMode","dispatch","updateBlocksWithUndo","updateBlocksWithoutUndo","_len","arguments","args","Array","_key","_len2","_key2"],"sources":["../../../src/components/block-editor-contents/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport isPromise from 'is-promise';\n\n/**\n * WordPress dependencies\n */\nimport { Popover } from '@wordpress/components';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { useLayoutEffect } from '@wordpress/element';\nimport { parse, rawHandler } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { BlockEditorProvider } from '@wordpress/block-editor';\nimport BlockEditor from '../block-editor';\nimport getInitialEditorContent from './editor-content';\n\n/** @typedef {import('../../store/editor/reducer').EditorMode} EditorMode */\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n/** @typedef {import('../../index').OnLoad} OnLoad */\n/** @typedef {import('../../index').OnMore} OnMore */\n\n/**\n * Get editor selection\n *\n * @callback OnSelection\n */\n\n/**\n * Update callback\n *\n * @callback OnUpdate\n * @param {object[]} blocks - Editor content to save\n * @param settings\n * @param [loader]\n * @param {Object} [options]\n */\nasync function getInitialContent( settings, loader ) {\n\tconst contentLoader = isPromise( loader )\n\t\t? loader\n\t\t: new Promise( ( resolve ) => {\n\t\t\t\tresolve( loader ? loader( parse, rawHandler ) : [] );\n\t\t  } );\n\n\treturn contentLoader.then( ( content ) => {\n\t\treturn getInitialEditorContent(\n\t\t\tsettings.iso.patterns,\n\t\t\tsettings.iso.currentPattern,\n\t\t\tsettings.editor.template,\n\t\t\tcontent\n\t\t);\n\t} );\n}\n\n/**\n * The editor itself, including toolbar\n *\n * @param {Object} props - Component props\n * @param {object[]} props.blocks\n * @param {OnUpdate} props.onInput - Callback to update blocks\n * @param {OnUpdate} props.onChange - Callback to update blocks\n * @param {boolean} props.isEditing - Are we editing in this editor?\n * @param {EditorMode} props.editorMode - Visual or code?\n * @param {Object} props.children - Child components\n * @param {BlockEditorSettings} props.settings - Settings\n * @param {OnMore} props.renderMoreMenu - Callback to render additional items in the more menu\n * @param {OnSelection} props.selection\n * @param {OnLoad} props.onLoad - Load initial blocks\n * @param {*} props.clearHistory - Callback to clear history\n */\n\nfunction BlockEditorContents( props ) {\n\tconst { blocks, onInput, onChange, selection, clearHistory, isEditing, editorMode } = props;\n\tconst { children, settings, renderMoreMenu, onLoad } = props;\n\n\t// Set initial content, if we have any, but only if there is no existing data in the editor (from elsewhere)\n\tuseLayoutEffect( () => {\n\t\tconst loadData = async () => {\n\t\t\tconst initialContent = await getInitialContent( settings, onLoad );\n\n\t\t\tif ( initialContent.length > 0 && ( ! blocks || blocks.length === 0 ) ) {\n\t\t\t\tonInput( initialContent, { isInitialContent: true } );\n\t\t\t}\n\n\t\t\tclearHistory();\n\t\t};\n\n\t\tloadData();\n\t}, [] );\n\n\treturn (\n\t\t<BlockEditorProvider\n\t\t\tvalue={ blocks || [] }\n\t\t\tonInput={ onInput }\n\t\t\tonChange={ onChange }\n\t\t\tuseSubRegistry={ false }\n\t\t\tselection={ selection }\n\t\t\tsettings={ settings.editor }\n\t\t>\n\t\t\t<BlockEditor\n\t\t\t\tisEditing={ isEditing }\n\t\t\t\teditorMode={ editorMode }\n\t\t\t\tsettings={ settings }\n\t\t\t\trenderMoreMenu={ renderMoreMenu }\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</BlockEditor>\n\n\t\t\t{\n\t\t\t\t// @ts-ignore\n\t\t\t\t<Popover.Slot />\n\t\t\t}\n\t\t</BlockEditorProvider>\n\t);\n}\n\n// @ts-ignore\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst { getBlocks, getEditorSelection, getEditorMode, isEditing } = select( 'isolated/editor' );\n\t\treturn {\n\t\t\tblocks: ownProps.blocks ?? getBlocks(),\n\t\t\tselection: getEditorSelection(),\n\t\t\tisEditing: isEditing(),\n\t\t\teditorMode: getEditorMode(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst { updateBlocksWithUndo, updateBlocksWithoutUndo, clearHistory } = dispatch( 'isolated/editor' );\n\t\tconst { onInput, onChange } = ownProps;\n\n\t\treturn {\n\t\t\tonChange: ( ...args ) => {\n\t\t\t\tonChange?.( ...args );\n\t\t\t\tupdateBlocksWithUndo( ...args );\n\t\t\t},\n\t\t\tonInput: ( ...args ) => {\n\t\t\t\tonInput?.( ...args );\n\t\t\t\tupdateBlocksWithoutUndo( ...args );\n\t\t\t},\n\t\t\tclearHistory,\n\t\t};\n\t} ),\n] )( BlockEditorContents );\n"],"mappings":"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"}