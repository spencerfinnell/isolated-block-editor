{"version":3,"file":"index.js","names":["_isPromise","_interopRequireDefault","require","_components","_data","_compose","_element","_blocks","_blockEditor","_blockEditor2","_editorContent","createElement","getInitialContent","_x","_x2","_getInitialContent","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee2","settings","loader","contentLoader","wrap","_callee2$","_context2","prev","next","isPromise","Promise","resolve","parse","rawHandler","abrupt","then","content","getInitialEditorContent","iso","patterns","currentPattern","editor","template","stop","BlockEditorContents","props","blocks","onInput","onChange","selection","clearHistory","isEditing","editorMode","children","renderMoreMenu","onLoad","useLayoutEffect","loadData","_ref","_callee","initialContent","_callee$","_context","sent","length","isInitialContent","BlockEditorProvider","value","useSubRegistry","Popover","Slot","_default","compose","withSelect","select","ownProps","_ownProps$blocks","_select","getBlocks","getEditorSelection","getEditorMode","withDispatch","dispatch","_dispatch","updateBlocksWithUndo","updateBlocksWithoutUndo","_len","args","Array","_key","_len2","_key2","exports"],"sources":["../../../src/components/block-editor-contents/index.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport isPromise from 'is-promise';\n\n/**\n * WordPress dependencies\n */\nimport { Popover } from '@wordpress/components';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { useLayoutEffect } from '@wordpress/element';\nimport { parse, rawHandler } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { BlockEditorProvider } from '@wordpress/block-editor';\nimport BlockEditor from '../block-editor';\nimport getInitialEditorContent from './editor-content';\n\n/** @typedef {import('../../store/editor/reducer').EditorMode} EditorMode */\n/** @typedef {import('../../index').BlockEditorSettings} BlockEditorSettings */\n/** @typedef {import('../../index').OnLoad} OnLoad */\n/** @typedef {import('../../index').OnMore} OnMore */\n\n/**\n * Get editor selection\n *\n * @callback OnSelection\n */\n\n/**\n * Update callback\n *\n * @callback OnUpdate\n * @param {object[]} blocks - Editor content to save\n * @param settings\n * @param [loader]\n * @param {Object} [options]\n */\nasync function getInitialContent( settings, loader ) {\n\tconst contentLoader = isPromise( loader )\n\t\t? loader\n\t\t: new Promise( ( resolve ) => {\n\t\t\t\tresolve( loader ? loader( parse, rawHandler ) : [] );\n\t\t  } );\n\n\treturn contentLoader.then( ( content ) => {\n\t\treturn getInitialEditorContent(\n\t\t\tsettings.iso.patterns,\n\t\t\tsettings.iso.currentPattern,\n\t\t\tsettings.editor.template,\n\t\t\tcontent\n\t\t);\n\t} );\n}\n\n/**\n * The editor itself, including toolbar\n *\n * @param {Object} props - Component props\n * @param {object[]} props.blocks\n * @param {OnUpdate} props.onInput - Callback to update blocks\n * @param {OnUpdate} props.onChange - Callback to update blocks\n * @param {boolean} props.isEditing - Are we editing in this editor?\n * @param {EditorMode} props.editorMode - Visual or code?\n * @param {Object} props.children - Child components\n * @param {BlockEditorSettings} props.settings - Settings\n * @param {OnMore} props.renderMoreMenu - Callback to render additional items in the more menu\n * @param {OnSelection} props.selection\n * @param {OnLoad} props.onLoad - Load initial blocks\n * @param {*} props.clearHistory - Callback to clear history\n */\n\nfunction BlockEditorContents( props ) {\n\tconst { blocks, onInput, onChange, selection, clearHistory, isEditing, editorMode } = props;\n\tconst { children, settings, renderMoreMenu, onLoad } = props;\n\n\t// Set initial content, if we have any, but only if there is no existing data in the editor (from elsewhere)\n\tuseLayoutEffect( () => {\n\t\tconst loadData = async () => {\n\t\t\tconst initialContent = await getInitialContent( settings, onLoad );\n\n\t\t\tif ( initialContent.length > 0 && ( ! blocks || blocks.length === 0 ) ) {\n\t\t\t\tonInput( initialContent, { isInitialContent: true } );\n\t\t\t}\n\n\t\t\tclearHistory();\n\t\t};\n\n\t\tloadData();\n\t}, [] );\n\n\treturn (\n\t\t<BlockEditorProvider\n\t\t\tvalue={ blocks || [] }\n\t\t\tonInput={ onInput }\n\t\t\tonChange={ onChange }\n\t\t\tuseSubRegistry={ false }\n\t\t\tselection={ selection }\n\t\t\tsettings={ settings.editor }\n\t\t>\n\t\t\t<BlockEditor\n\t\t\t\tisEditing={ isEditing }\n\t\t\t\teditorMode={ editorMode }\n\t\t\t\tsettings={ settings }\n\t\t\t\trenderMoreMenu={ renderMoreMenu }\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</BlockEditor>\n\n\t\t\t{\n\t\t\t\t// @ts-ignore\n\t\t\t\t<Popover.Slot />\n\t\t\t}\n\t\t</BlockEditorProvider>\n\t);\n}\n\n// @ts-ignore\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst { getBlocks, getEditorSelection, getEditorMode, isEditing } = select( 'isolated/editor' );\n\t\treturn {\n\t\t\tblocks: ownProps.blocks ?? getBlocks(),\n\t\t\tselection: getEditorSelection(),\n\t\t\tisEditing: isEditing(),\n\t\t\teditorMode: getEditorMode(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst { updateBlocksWithUndo, updateBlocksWithoutUndo, clearHistory } = dispatch( 'isolated/editor' );\n\t\tconst { onInput, onChange } = ownProps;\n\n\t\treturn {\n\t\t\tonChange: ( ...args ) => {\n\t\t\t\tonChange?.( ...args );\n\t\t\t\tupdateBlocksWithUndo( ...args );\n\t\t\t},\n\t\t\tonInput: ( ...args ) => {\n\t\t\t\tonInput?.( ...args );\n\t\t\t\tupdateBlocksWithoutUndo( ...args );\n\t\t\t},\n\t\t\tclearHistory,\n\t\t};\n\t} ),\n] )( BlockEditorContents );\n"],"mappings":"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"}